import{_ as c,c as u,d as a,a as p,e as s,b as e,w as o,r as i,o as r}from"./app-C1uG88mu.js";const d="/assets/regional-edge-functions-C-OzzWyA.png",k="/assets/Postman_Exh1yNav6L-BFQl8qSF.png",m="/assets/chrome_bWPHXYUvq5-KwtbzUsI.png",v={},h={id:"edge-functions",tabindex:"-1"},g={class:"header-anchor",href:"#edge-functions"};function b(y,n){const l=i("Badge"),t=i("RouteLink");return r(),u("div",null,[a("h1",h,[a("a",g,[a("span",null,[n[0]||(n[0]=s("Edge Functions ",-1)),e(l,{text:"closed beta",type:"warning"})])])]),n[10]||(n[10]=p('<p><img src="'+d+'" alt="regional-edge-functions.png"></p><h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction"><span>Introduction</span></a></h2><p>Edge Functions are a powerful way to extend the functionality of your extension. They allow you to run serverless functions at the edge of the network, closer to your users, and provide a way to add server-side custom logic to your extension.</p><p>They are written in TypeScript and JavaScript and run on the OWN3D platform. Edge Functions are triggered by events such as HTTP requests and can be used to modify the request or response, or to perform custom logic like data validation, authentication, and authorization.</p><p>Under the hood, Edge Functions are powered by <a href="https://deno.land/" target="_blank" rel="noopener noreferrer">Deno</a>, the most productive, secure, and performant JavaScript and TypeScript runtime. Used by companies like Slack, GitHub, Google, and many others. Deno is backwards compatible with Node.js built-in APIs and over two million modules on npm. Bring the best of the Node.js ecosystem with you to Deno.</p><h3 id="use-cases" tabindex="-1"><a class="header-anchor" href="#use-cases"><span>Use Cases</span></a></h3><h3 id="store-and-retrieve-data-from-the-key-value-store" tabindex="-1"><a class="header-anchor" href="#store-and-retrieve-data-from-the-key-value-store"><span>Store and Retrieve Data from the Key-Value Store</span></a></h3><p>Edge Functions can be used to store and retrieve data from the Key-Value Store. This is useful when you want to store small amounts of data, such as settings, preferences, and other small pieces of data.</p>',8)),a("p",null,[n[2]||(n[2]=s("To learn more about the Key-Value Store, see the ",-1)),e(t,{to:"/docs/cloud/kv.html"},{default:o(()=>[...n[1]||(n[1]=[s("Key-Value Store",-1)])]),_:1}),n[3]||(n[3]=s(" documentation.",-1))]),n[11]||(n[11]=p(`<div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;jsr:@gz/kv&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> kv <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">kv<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    id<span class="token operator">:</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    name<span class="token operator">:</span> <span class="token string">&#39;John Doe&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    email<span class="token operator">:</span> <span class="token string">&#39;john@example.com&#39;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="user-authentication" tabindex="-1"><a class="header-anchor" href="#user-authentication"><span>User Authentication</span></a></h4><p>Edge Functions can be used to authenticate and authorize requests to your extension. This is especially useful when you want to protect your extension from unauthorized access.</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>You can use JavaScript modules from npm in your Deno programs with the &quot;<strong>npm:</strong>&quot; specifier in your import statements.</p></div><p><img src="`+k+`" alt="postman client"></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> decode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;jsr:@gz/jwt&#39;</span></span>
<span class="line"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">&#39;npm:express&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">verifyToken</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> authHeader <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>authHeader <span class="token operator">&amp;&amp;</span> authHeader<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;Bearer &#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> token <span class="token operator">=</span> authHeader<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> authHeader<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Add the decoded token to the request object</span></span>
<span class="line">            req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token string">&#39;secret&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">&#39;HS256&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Proceed to the next middleware or route handler</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>_err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;Invalid token&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;No token provided&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/extension&#39;</span><span class="token punctuation">,</span> verifyToken<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&#39;Token is valid&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">user</span><span class="token operator">:</span> req<span class="token punctuation">.</span>user <span class="token comment">// Use the decoded token information from the middleware</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Server running on port 80</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="getting-started" tabindex="-1"><a class="header-anchor" href="#getting-started"><span>Getting Started</span></a></h2>`,7)),a("p",null,[n[5]||(n[5]=s("Getting started with OWN3D Edge Functions is easy. The installation process is simple, and you can start writing and deploying your Edge Functions in minutes using our ",-1)),e(t,{to:"/docs/cli/"},{default:o(()=>[...n[4]||(n[4]=[s("CLI tool",-1)])]),_:1}),n[6]||(n[6]=s(".",-1))]),a("p",null,[n[8]||(n[8]=s("If you haven't already our CLI tool, you can follow the instructions in the ",-1)),e(t,{to:"/docs/cli/#install-deno-and-the-own3d-cli"},{default:o(()=>[...n[7]||(n[7]=[s("CLI installation guide",-1)])]),_:1}),n[9]||(n[9]=s(".",-1))]),n[12]||(n[12]=p(`<h2 id="write-and-test-a-deno-program" tabindex="-1"><a class="header-anchor" href="#write-and-test-a-deno-program"><span>Write and test a Deno program</span></a></h2><p>You can write a simple Deno program and run it using the following command:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line">Deno<span class="token punctuation">.</span><span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You can run the program using the following command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">deno run --allow-net server.ts</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="deploy-functions-using-the-developer-console" tabindex="-1"><a class="header-anchor" href="#deploy-functions-using-the-developer-console"><span>Deploy Functions using the Developer Console</span></a></h2><h3 id="create-a-new-edge-function" tabindex="-1"><a class="header-anchor" href="#create-a-new-edge-function"><span>Create a New Edge Function</span></a></h3><p>To create a new Edge Function, start by accessing the Developer Console and navigating to the <a href="https://console.dev.own3d.tv/resources/edge-functions" target="_blank" rel="noopener noreferrer">Edge Functions</a> section. Click on the &quot;Create Edge Function&quot; button, which will open a new form for entering your function details.</p><p><img src="`+m+`" alt="create edge function"></p><p>First, you’ll need to provide a name for your Edge Function. This name will be part of the URL where the function is deployed; for example, if you name it &quot;my-function,&quot; it will be accessible at <code>my-function.fn.ext-own3d.tv</code>. By default, we will generate a unique URL for your function, but you can also specify a custom URL if you prefer. Additionally, you can specify any environment variables that will be available to your Edge Function.</p><h2 id="deploy-functions-using-the-own3d-cli" tabindex="-1"><a class="header-anchor" href="#deploy-functions-using-the-own3d-cli"><span>Deploy Functions using the OWN3D CLI</span></a></h2><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>The CLI tool is currently in closed beta. We recommend using the Developer Console to create and deploy Edge Functions until the CLI tool is available to the public.</p></div><p>Creating and deploying Edge Functions using the OWN3D CLI allows you to create more complex Edge Functions with multiple files and dependencies. The CLI tool provides a simple way to create, deploy, and manage your Edge Functions without the need to use the Developer Console.</p><h3 id="create-a-new-edge-function-1" tabindex="-1"><a class="header-anchor" href="#create-a-new-edge-function-1"><span>Create a New Edge Function</span></a></h3><p>To create a new Edge Function, you can use the <code>fn:create</code> command from the OWN3D CLI. This will create a new directory with a basic Edge Function template.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">own3d fn:create my-function</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This will create a new directory called <code>my-function</code> with the following structure:</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">my-function</span>
<span class="line">├── .gitignore</span>
<span class="line">├── .own3d</span>
<span class="line">│   └── manifest.json</span>
<span class="line">└── index.ts</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="deploy-the-edge-function" tabindex="-1"><a class="header-anchor" href="#deploy-the-edge-function"><span>Deploy the Edge Function</span></a></h3><p>To deploy the Edge Function, you can use the <code>fn:deploy</code> command from the OWN3D CLI.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">own3d fn:deploy my-function</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This will deploy the Edge Function and provide you with the URL where it is deployed.</p><div class="language-plaintext line-numbers-mode" data-highlighter="prismjs" data-ext="plaintext"><pre><code class="language-plaintext"><span class="line">- Compressing my-function function...</span>
<span class="line">  updating: .own3d/ (stored 0%)</span>
<span class="line">  updating: .own3d/manifest.json (deflated 24%)</span>
<span class="line">  updating: index.ts (deflated 27%)</span>
<span class="line">✔ Function compressed</span>
<span class="line">- Deploying my-function function...</span>
<span class="line">✔ Deployment is live!</span>
<span class="line"></span>
<span class="line">Website URL: my-function-xxxxxxxxxxxx.fn.ext-own3d.tv</span>
<span class="line">Website URL: my-function.fn.ext-own3d.tv</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now, you can use the URL to trigger the Edge Function.</p>`,24))])}const w=c(v,[["render",b]]),x=JSON.parse('{"path":"/docs/cloud/edge-functions.html","title":"Edge Functions","lang":"en-US","frontmatter":{},"git":{},"filePathRelative":"docs/cloud/edge-functions.md"}');export{w as comp,x as data};

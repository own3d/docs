import{_ as s,c as a,a as e,o as t}from"./app-C1uG88mu.js";const o="/assets/oauth-authorization-Br5fJ58X.png",p={};function i(c,n){return t(),a("div",null,[...n[0]||(n[0]=[e(`<h1 id="authorization" tabindex="-1"><a class="header-anchor" href="#authorization"><span>Authorization</span></a></h1><h2 id="what-is-oauth2" tabindex="-1"><a class="header-anchor" href="#what-is-oauth2"><span>What is OAuth2?</span></a></h2><p>It is a standard protocol for allowing users to sign in to applications without requiring users to enter their credentials. Many platforms like Google, Facebook, and GitHub use OAuth2.</p><h3 id="terminology" tabindex="-1"><a class="header-anchor" href="#terminology"><span>Terminology</span></a></h3><ul><li><strong>Client</strong>: The application that is requesting access to a user&#39;s data.</li><li><strong>Authorization Code</strong>: A code that is used to obtain an access token.</li><li><strong>Access Token</strong>: A user token that grants the application access to a user&#39;s data.</li><li><strong>App Access Token</strong>: A machine-to-machine app access token that is used to access the application&#39;s API.</li><li><strong>Refresh Token</strong>: A token that is used to obtain a new access token when the current one expires.</li><li><strong>Scope</strong>: The level of access that the application is requesting.</li><li><strong>Redirect URI</strong>: The URI that the application should redirect to after the user grants or denies access.</li><li><strong>Streaming Service</strong>: A live-streaming service like Twitch, YouTube that the user can link to OWN3D.</li><li><strong>Third-Party Account &amp; Connection</strong>: An account on a third-party service like TikTok, Discord, Spotify that the user can link to OWN3D to access the user&#39;s data.</li><li><strong>OWN3D Service</strong>: A service provided by OWN3D like the Pro, Shop, etc.</li><li><strong>Third-Party App &amp; Service</strong>: An application that uses OWN3D&#39;s API&#39;s to access the user&#39;s data.</li></ul><h2 id="client-registration" tabindex="-1"><a class="header-anchor" href="#client-registration"><span>Client Registration</span></a></h2><p>To getting started, with our API&#39;s, you need to request a client id and client secret for your Third-Party App &amp; Service. You can do this by fill out the <a href="https://forms.gle/4miiLAksbFTEGg3c6" target="_blank" rel="noopener noreferrer">OAuth2 Client Registration</a> form with the following information:</p><ul><li>Your application&#39;s name</li><li>Your application&#39;s website</li><li>Your application&#39;s description</li><li>Your application&#39;s logo</li><li>Your application&#39;s privacy policy</li><li>Your application&#39;s terms of service</li><li>Your application&#39;s redirect URI</li></ul><h2 id="types-of-tokens" tabindex="-1"><a class="header-anchor" href="#types-of-tokens"><span>Types of Tokens</span></a></h2><p>We currently support two types of tokens:</p><table><thead><tr><th>Token Type</th><th>Description</th></tr></thead><tbody><tr><td>User Access Token</td><td>An access token that grants the application access to a user&#39;s data. You can use this token to access the user&#39;s data.</td></tr><tr><td>App Access Token</td><td>An access token that grants the application access to the application&#39;s API. Mostly intended for machine-to-machine communication.</td></tr></tbody></table><p>User Access Tokens and App Access Tokens are both bearer tokens. Bearer tokens are used to authenticate the application.</p><h2 id="issuing-access-tokens" tabindex="-1"><a class="header-anchor" href="#issuing-access-tokens"><span>Issuing Access Tokens</span></a></h2><h3 id="requesting-tokens" tabindex="-1"><a class="header-anchor" href="#requesting-tokens"><span>Requesting Tokens</span></a></h3><p>Using OAuth2 via the authorization code flow is how most developers are familiar with OAuth2. When using the authorization code flow, the client will redirect the user to the authorization server to grant access to the application. The authorization server will then redirect the user back to the application with an authorization code in the URL. The client will then exchange the authorization code for an access token.</p><p>Later, the client can use the access token to access the user&#39;s data.</p><h4 id="redirecting-for-authorization" tabindex="-1"><a class="header-anchor" href="#redirecting-for-authorization"><span>Redirecting for Authorization</span></a></h4><p>Once a client has been created, we will use the authorization code flow to get an access token. To visualize the flow, we will use javascript to redirect the user to the authorization server. You will find your client id in the <a href="https://console.dev.own3d.tv/resources/passport-clients" target="_blank" rel="noopener noreferrer">Passport Client</a> section of the OWN3D Developer Console.</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Ensure that you have added the redirect URI to your <a href="https://console.dev.own3d.tv/resources/passport-clients" target="_blank" rel="noopener noreferrer">Passport Client</a> in the OWN3D Developer Console. Otherwise, the authorization server will throw a &quot;<strong>Client authentication failed</strong>&quot; error.</p></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Redirect the user to the authorization server</span></span>
<span class="line">window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;https://id.stream.tv/oauth/authorize?client_id=&lt;&gt;&amp;redirect_uri=&lt;&gt;&amp;response_type=code&amp;scope=&lt;&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>prompt</code> parameter can be used to specify the authentication behavior. The following values are supported:</p><ul><li><code>none</code>: OWN3D ID will always throw an authentication error if the user is not already authenticated.</li><li><code>consent</code>: OWN3D ID always display the authorization approval screen, even if all scopes are already granted.</li><li><code>login</code>: OWN3D ID will always prompt the user to re-login, even if they are already logged in.</li></ul><p>If no <code>prompt</code> value is provided, the user will be prompted for authorization only if they have not previously authorized access to the consuming application for the requested scopes.</p><p>The <code>login_fallback</code> parameter can be used to specify the fallback behavior if the user is not logged in depending on the <code>prompt</code> value. The following values are supported: <code>email</code>, <code>twitch</code>, <code>youtube</code>, <code>tiktok</code> and other providers.</p><h4 id="approving-the-request" tabindex="-1"><a class="header-anchor" href="#approving-the-request"><span>Approving the Request</span></a></h4><p>The user will then be redirected to the application with the authorization code in the URL. From there, the user must click on the &quot;Authorize&quot; button to grant the application access to the user&#39;s data:</p><div style="text-align:center;"><img src="`+o+`" alt="Authorization Code Flow" style="border:1px solid #181e23;border-radius:8px;"></div><h4 id="converting-authorization-codes-to-access-tokens" tabindex="-1"><a class="header-anchor" href="#converting-authorization-codes-to-access-tokens"><span>Converting Authorization Codes to Access Tokens</span></a></h4><p>After that we use php to get the access token from the authorization server.</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Facades<span class="token punctuation">\\</span>Http</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Get the authorization code from the URL</span></span>
<span class="line"><span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;code&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Exchange the authorization code for an access token using laravel http facades</span></span>
<span class="line"><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token class-name static-context">Http</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;https://id.stream.tv/oauth/token&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;client_id&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&lt;&gt;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;client_secret&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&lt;&gt;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;redirect_uri&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&lt;&gt;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;code&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$code</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;grant_type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;authorization_code&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Get the access token from the response</span></span>
<span class="line"><span class="token variable">$access_token</span> <span class="token operator">=</span> <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;access_token&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you are familiar with laravel, you may want to check our <a href="https://github.com/own3d/id" target="_blank" rel="noopener noreferrer">own3d/id</a> package. It is a laravel package that provides a simple way to work with our API&#39;s.</p><h3 id="requesting-all-scopes" tabindex="-1"><a class="header-anchor" href="#requesting-all-scopes"><span>Requesting All Scopes</span></a></h3><p>If you want to request all scopes, you can use the <code>*</code> wildcard.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Redirect the user to the authorization server</span></span>
<span class="line"></span>
<span class="line">window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;https://id.stream.tv/oauth/authorize?client_id=&lt;&gt;&amp;redirect_uri=&lt;&gt;&amp;response_type=code&amp;scope=*&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="refreshing-tokens" tabindex="-1"><a class="header-anchor" href="#refreshing-tokens"><span>Refreshing Tokens</span></a></h3><p>Refresh tokens are used to obtain a new access token when the current one expires. With the following example, we will use the refresh token flow to get a new access token.</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token comment">// Get the refresh token from the response</span></span>
<span class="line"><span class="token variable">$refresh_token</span> <span class="token operator">=</span> <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;refresh_token&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Exchange the refresh token for a new access token</span></span>
<span class="line"><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>Http</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;https://id.stream.tv/oauth/token&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;client_id&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&lt;&gt;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;client_secret&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&lt;&gt;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;redirect_uri&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&lt;&gt;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;refresh_token&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$refresh_token</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string single-quoted-string">&#39;grant_type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;refresh_token&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// Get the access token from the response</span></span>
<span class="line"><span class="token variable">$access_token</span> <span class="token operator">=</span> <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;access_token&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="token-expiration" tabindex="-1"><a class="header-anchor" href="#token-expiration"><span>Token Expiration</span></a></h3><p>Typically, the <code>/oauth/token</code> endpoint will return a <code>expires_in</code> field that indicates the number of seconds until the token expires.</p><p>By default, access tokens expire after 15 days and refresh tokens after 30 days. This means after expiration of the access token, you will need to use the refresh token within 15 days to get a new access token. If you don&#39;t use the refresh token within 30 days, the user will be required to re-authenticate.</p><p>Personal access tokens having a lifetime of 6 months. These tokens cannot be refreshed automatically.</p><h2 id="authorization-code-grant-with-pkce" tabindex="-1"><a class="header-anchor" href="#authorization-code-grant-with-pkce"><span>Authorization Code Grant With PKCE</span></a></h2><p>The authorization code grant with &quot;Proof Key for Code Exchange&quot; (PKCE) is an extension of the authorization code grant that is intended to be more secure for public clients.</p><h3 id="creating-the-client" tabindex="-1"><a class="header-anchor" href="#creating-the-client"><span>Creating the Client</span></a></h3><p>Before your application can issue tokens via the authorization code grant with PKCE, you will need to create a PKCE-enabled client. A PKCE-enabled client is a client that does not have a client secret.</p><h3 id="requesting-tokens-1" tabindex="-1"><a class="header-anchor" href="#requesting-tokens-1"><span>Requesting Tokens</span></a></h3><h4 id="code-verifier-and-code-challenge" tabindex="-1"><a class="header-anchor" href="#code-verifier-and-code-challenge"><span>Code Verifier and Code Challenge</span></a></h4><p>As this authorization grant does not provide a client secret, developers will need to generate a combination of a code verifier and a code challenge in order to request a token.</p><p>The code verifier should be a random string of between 43 and 128 characters containing letters, numbers, and <code>-</code>, <code>.</code>, <code>_</code>, <code>~</code> characters, as defined in the <a href="https://tools.ietf.org/html/rfc7636" target="_blank" rel="noopener noreferrer">RFC 7636 specification</a>.</p><p>The code challenge should be a Base64 encoded string with URL and filename-safe characters. The trailing <code>=</code> characters should be removed and no line breaks, whitespace, or other additional characters should be present.</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token variable">$encoded</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;sha256&#39;</span><span class="token punctuation">,</span> <span class="token variable">$code_verifier</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line"><span class="token variable">$codeChallenge</span> <span class="token operator">=</span> <span class="token function">strtr</span><span class="token punctuation">(</span><span class="token function">rtrim</span><span class="token punctuation">(</span><span class="token variable">$encoded</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;=&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;+/&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;-_&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>or in javascript:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">function</span> <span class="token function">dec2hex</span><span class="token punctuation">(</span>dec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&#39;0&#39;</span> <span class="token operator">+</span> dec<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">generateRandomString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint32Array</span><span class="token punctuation">(</span><span class="token number">56</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">    crypto<span class="token punctuation">.</span><span class="token function">getRandomValues</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> dec2hex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">sha256</span><span class="token punctuation">(</span>plain<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> encoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> data <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>plain<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> crypto<span class="token punctuation">.</span>subtle<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&#39;SHA-256&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">base64urlencode</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">    <span class="token keyword">const</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> len <span class="token operator">=</span> bytes<span class="token punctuation">.</span>byteLength</span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        str <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">btoa</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;-&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;_&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">=+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> codeVerifier <span class="token operator">=</span> <span class="token function">generateRandomString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">const</span> codeChallange <span class="token operator">=</span> <span class="token function">base64urlencode</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">sha256</span><span class="token punctuation">(</span>codeVerifier<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="redirecting-for-authorization-1" tabindex="-1"><a class="header-anchor" href="#redirecting-for-authorization-1"><span>Redirecting for Authorization</span></a></h4><p>Once a client has been created, you may use the client ID and the generated code verifier and code challenge to request an authorization code and access token from your application. First, the consuming application should make a redirect request to OWN3D ID&#39;s <code>/oauth/authorize</code> route:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Http<span class="token punctuation">\\</span>Request</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Str</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line"><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/redirect&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;state&#39;</span><span class="token punctuation">,</span> <span class="token variable">$state</span> <span class="token operator">=</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">    <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">put</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;code_verifier&#39;</span><span class="token punctuation">,</span> <span class="token variable">$code_verifier</span> <span class="token operator">=</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">    <span class="token variable">$codeChallenge</span> <span class="token operator">=</span> <span class="token function">strtr</span><span class="token punctuation">(</span><span class="token function">rtrim</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;sha256&#39;</span><span class="token punctuation">,</span> <span class="token variable">$code_verifier</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;=&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;+/&#39;</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;-_&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;client_id&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;client-id&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;redirect_uri&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;https://third-party-app.com/callback&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;response_type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;code&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;scope&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;state&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$state</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;code_challenge&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$codeChallenge</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;code_challenge_method&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;S256&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token comment">// &#39;prompt&#39; =&gt; &#39;&#39;, // &quot;none&quot;, &quot;consent&quot;, or &quot;login&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;https://id.stream.tv/oauth/authorize?&#39;</span><span class="token operator">.</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="converting-authorization-codes-to-access-tokens-1" tabindex="-1"><a class="header-anchor" href="#converting-authorization-codes-to-access-tokens-1"><span>Converting Authorization Codes to Access Tokens</span></a></h4><p>If the user approves the request, the authorization server will redirect the user back to the application with an authorization code in the URL. The application can then exchange the authorization code for an access token:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Http<span class="token punctuation">\\</span>Request</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Facades<span class="token punctuation">\\</span>Http</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line"><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/callback&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token variable">$state</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;state&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">    <span class="token variable">$codeVerifier</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;code_verifier&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">    <span class="token function">throw_unless</span><span class="token punctuation">(</span></span>
<span class="line">        <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$state</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$state</span> <span class="token operator">===</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">state</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token class-name static-context">InvalidArgumentException</span><span class="token operator">::</span><span class="token keyword">class</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token class-name static-context">Http</span><span class="token operator">::</span><span class="token function">asForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;https://id.stream.tv/oauth/token&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;grant_type&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;authorization_code&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;client_id&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;client-id&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;redirect_uri&#39;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">&#39;https://third-party-app.com/callback&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;code_verifier&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$codeVerifier</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string single-quoted-string">&#39;code&#39;</span> <span class="token operator">=&gt;</span> <span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token property">code</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> </span>
<span class="line">    <span class="token keyword">return</span> <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="password-grant-tokens" tabindex="-1"><a class="header-anchor" href="#password-grant-tokens"><span>Password Grant Tokens</span></a></h2><p>The password grant is no longer supported and should not be used. See <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics#name-resource-owner-password-cre" target="_blank" rel="noopener noreferrer">here</a> for more information.</p><h2 id="token-scopes" tabindex="-1"><a class="header-anchor" href="#token-scopes"><span>Token Scopes</span></a></h2><p>With Scope, you can specify the level of access that the application is requesting. We currently support the following scopes:</p><table><thead><tr><th>Scope</th><th>Description</th></tr></thead><tbody><tr><td><code>academy:read</code></td><td>Allows the application to read academy data.</td></tr><tr><td><code>academy:manage</code></td><td>Allows the application to manage academy data.</td></tr><tr><td><code>alerts:manage</code></td><td>Allows the application to manage alerts.</td></tr><tr><td><code>affiliate:manage</code></td><td>Allows the application to manage affiliate links.</td></tr><tr><td><code>analytics:read</code></td><td>Allows the application to read analytics data.</td></tr><tr><td><code>chatbot:read</code></td><td>Allows the application to read chatbot data.</td></tr><tr><td><code>chatbot:manage</code></td><td>Allows the application to manage chatbot data.</td></tr><tr><td><code>chatbot:manage:commands</code></td><td>Allows the application to manage chatbot commands.</td></tr><tr><td><code>chatbot:manage:moderation</code></td><td>Allows the application to manage chatbot moderation.</td></tr><tr><td><code>chatbot:manage:timers</code></td><td>Allows the application to manage chatbot timers.</td></tr><tr><td><code>chatbot:manage:giveaways</code></td><td>Allows the application to manage chatbot giveaways.</td></tr><tr><td><code>connections</code></td><td>Allows the application to manage social media connections.</td></tr><tr><td><code>donations:read</code></td><td>Allows the application to read donations data.</td></tr><tr><td><code>donations:manage</code></td><td>Allows the application to manage donations data.</td></tr><tr><td><code>entitlements:read</code></td><td>Allows the application to read entitlements data aka. purchased products.</td></tr><tr><td><code>extensions:read</code></td><td>Allows the application to read extensions data.</td></tr><tr><td><code>extensions:manage</code></td><td>Allows the application to manage extensions data, like changing configuration.</td></tr><tr><td><code>linkspree:manage</code></td><td>Allows the application to manage linkspree links.</td></tr><tr><td><code>orders:manage</code></td><td>Allows the application to manage orders data.</td></tr><tr><td><code>subscription:read</code></td><td>Allows the application to read subscription data.</td></tr><tr><td><code>user:read</code></td><td>Allows the application to read user data.</td></tr><tr><td><code>user:manage</code></td><td>Allows the application to manage user data.</td></tr><tr><td><code>user:manage:credentials</code></td><td>Allows the application to manage user credentials.</td></tr><tr><td><code>widgets:manage</code></td><td>Allows the application to manage widgets data.</td></tr></tbody></table><p>You will also find all scopes in our <a href="https://github.com/own3d/id/blob/master/src/Enums/Scope.php" target="_blank" rel="noopener noreferrer">Scope</a> Enum in GitHub.</p><h2 id="linking-streaming-services-and-third-party-accounts-connections" tabindex="-1"><a class="header-anchor" href="#linking-streaming-services-and-third-party-accounts-connections"><span>Linking Streaming Services and Third-Party Accounts &amp; Connections</span></a></h2><p>To link streaming services and third-party accounts &amp; connections, you can use the <code>/oauth/{provider}</code> endpoint.</p><p>The <code>provider</code> parameter is the name of the provider you want to link. We currently support the following providers: <code>twitch</code>, <code>youtube</code>, <code>tiktok</code>, <code>discord</code> and <code>spotify</code>.</p><p>The <code>continue</code> parameter is the URL that the user should be redirected to after linking the account.</p><p>The <code>prompt</code> parameter can be used to specify the authentication behavior. This parameter will be passed to the third-party service. Not all providers support all values. The following values are supported:</p><p><strong>YouTube</strong></p><ul><li><code>consent</code>: Always display the authorization approval screen, even if all scopes are already granted.</li></ul><p><strong>TikTok</strong></p><ul><li><code>login</code>: Always prompt the user to re-login. This will force the user to logout and re-login to TikTok.</li></ul><h2 id="unlinking-streaming-services-and-third-party-accounts-connections" tabindex="-1"><a class="header-anchor" href="#unlinking-streaming-services-and-third-party-accounts-connections"><span>Unlinking Streaming Services and Third-Party Accounts &amp; Connections</span></a></h2><p>To unlink streaming services and third-party accounts &amp; connections, you MUST redirect the user to the <code>https://id.stream.tv/data-and-privacy</code> or the <code>https://id.stream.tv/platforms/{connection}</code> page. The <code>connection</code> parameter is the ID of the connection you want to unlink.</p><p>For security reasons, we do not provide an API endpoint to unlink streaming services and third-party accounts &amp; connections.</p><p>Obtaining the connection ID can be done by using the <code>/api/users/@me/connections</code> endpoint.</p><div class="language-http line-numbers-mode" data-highlighter="prismjs" data-ext="http"><pre><code class="language-http"><span class="line">GET https://id.stream.tv/api/users/@me/connections</span>
<span class="line"><span class="token header"><span class="token header-name keyword">Authorization</span><span class="token punctuation">:</span> <span class="token header-value">Bearer &lt;access-token&gt;</span></span></span>
<span class="line"><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1194592</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;user_id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;platform&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tiktok&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;platform_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1791641f-4e70-4a22-9a91-b1406caa5e16&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;scopes&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token string">&quot;user.info.basic&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;user.info.profile&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;user.info.stats&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;expires_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-11-18T03:24:38.000000Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;created_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2021-12-23T10:07:23.000000Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;updated_at&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-11-17T03:24:38.000000Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;platform_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TikTok&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;platform_login&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ghostzero.dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;display_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ghostzero&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="logging-out" tabindex="-1"><a class="header-anchor" href="#logging-out"><span>Logging Out</span></a></h2><p>To log out the user, you can use the <code>/logout</code> endpoint.</p><p>The <code>continue</code> parameter is the URL that the user should be redirected to after logging out.</p>`,83)])])}const r=s(p,[["render",i]]),u=JSON.parse('{"path":"/docs/authorization.html","title":"Authorization","lang":"en-US","frontmatter":{},"git":{},"filePathRelative":"docs/authorization.md"}');export{r as comp,u as data};
